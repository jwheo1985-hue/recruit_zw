<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì±„ìš© ê´€ë¦¬ ì—ì´ì „íŠ¸</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
:root{--bg:#0b0e16;--s1:#111520;--s2:#181d2c;--s3:#1e2438;--bd:#252c42;--bd2:#2e3650;--blue:#4f9fff;--vio:#8b7cf8;--grn:#34d399;--yel:#fbbf24;--red:#f87171;--mu:#8b95b0;--tx:#e2e8f8;--r:12px;}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--tx);display:flex;height:100vh;overflow:hidden;font-size:14px;}

/* SIDEBAR */
#sb{width:230px;min-width:230px;background:var(--s1);border-right:1px solid var(--bd);display:flex;flex-direction:column;}
.logo{padding:22px 20px 18px;border-bottom:1px solid var(--bd);}
.logo-t{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--blue);letter-spacing:2px;margin-bottom:3px;}
.logo-s{font-size:11px;color:var(--mu);}
.ns{padding:18px 20px 6px;font-size:10px;color:var(--mu);letter-spacing:2px;text-transform:uppercase;}
.ni{display:flex;align-items:center;gap:10px;padding:11px 14px;margin:2px 8px;border-radius:9px;cursor:pointer;color:var(--mu);font-size:13px;font-weight:500;transition:background .15s,color .15s;user-select:none;}
.ni:hover{background:var(--s2);color:var(--tx);}
.ni.active{background:rgba(79,159,255,.13);color:var(--blue);}
.nico{font-size:15px;width:22px;text-align:center;flex-shrink:0;}
.ncnt{margin-left:auto;font-family:'JetBrains Mono',monospace;font-size:10px;background:var(--s3);padding:2px 8px;border-radius:20px;color:var(--mu);min-width:24px;text-align:center;}
.ni.active .ncnt{background:rgba(79,159,255,.2);color:var(--blue);}
.sbfoot{margin-top:auto;padding:14px 18px;border-top:1px solid var(--bd);font-size:11px;color:var(--mu);}

/* MAIN */
#main{flex:1;display:flex;flex-direction:column;overflow:hidden;}
#topbar{height:58px;background:var(--s1);border-bottom:1px solid var(--bd);display:flex;align-items:center;padding:0 26px;gap:12px;flex-shrink:0;}
#ptitle{font-size:15px;font-weight:700;flex:1;}
#content{flex:1;overflow-y:auto;padding:26px;scrollbar-width:thin;scrollbar-color:var(--bd2) transparent;}
#content::-webkit-scrollbar{width:5px;}
#content::-webkit-scrollbar-thumb{background:var(--bd2);border-radius:10px;}
.page{display:none;animation:fi .2s ease;}
.page.active{display:block;}
@keyframes fi{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* DASHBOARD */
.srow{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:22px;}
.sc{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:18px 20px;position:relative;overflow:hidden;}
.sc::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
.sc.b::after{background:var(--blue)}.sc.v::after{background:var(--vio)}.sc.g::after{background:var(--grn)}.sc.r::after{background:var(--red)}
.sc-l{font-size:11px;color:var(--mu);margin-bottom:10px;}
.sc-v{font-family:'JetBrains Mono',monospace;font-size:30px;font-weight:500;}
.sc.b .sc-v{color:var(--blue)}.sc.v .sc-v{color:var(--vio)}.sc.g .sc-v{color:var(--grn)}.sc.r .sc-v{color:var(--red)}
.sc-s{font-size:11px;color:var(--mu);margin-top:6px;}
.pc{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:20px 22px;margin-bottom:20px;}
.pc h3{font-size:13px;color:var(--mu);margin-bottom:18px;}
.ps{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;}
.psi{background:var(--s2);border-radius:9px;padding:14px;text-align:center;}
.psi-l{font-size:11px;color:var(--mu);margin-bottom:8px;}
.psi-n{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:500;}
.card{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden;}
.card-hd{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--bd);}
.card-t{font-size:13px;font-weight:600;}
table{width:100%;border-collapse:collapse;}
th{background:var(--s2);font-size:11px;color:var(--mu);padding:10px 16px;text-align:left;font-weight:500;}
td{padding:11px 16px;font-size:13px;border-bottom:1px solid var(--bd);vertical-align:middle;}
tr:last-child td{border-bottom:none;}
tbody tr:hover td{background:rgba(255,255,255,.02);cursor:pointer;}

/* BADGES */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;white-space:nowrap;}
.b-ì„œë¥˜ê²€í† {background:rgba(79,159,255,.15);color:var(--blue);}
.b-1ì°¨ë©´ì ‘{background:rgba(139,124,248,.15);color:var(--vio);}
.b-2ì°¨ë©´ì ‘{background:rgba(251,191,36,.15);color:var(--yel);}
.b-ìµœì¢…í•©ê²©{background:rgba(52,211,153,.15);color:var(--grn);}
.b-ë¶ˆí•©ê²©{background:rgba(248,113,113,.15);color:var(--red);}
.b-ë³´ë¥˜{background:rgba(139,149,176,.15);color:var(--mu);}

/* FILTER */
.fbar{display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap;align-items:center;}
.sw{flex:1;min-width:200px;position:relative;}
.si{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--mu);pointer-events:none;}
.sw input{padding-left:34px !important;width:100%;}
input,select,textarea{background:var(--s1);border:1px solid var(--bd);border-radius:8px;padding:9px 12px;color:var(--tx);font-size:13px;font-family:inherit;outline:none;transition:border-color .15s;}
input:focus,select:focus,textarea:focus{border-color:var(--blue);}
select option{background:var(--s2);}
textarea{resize:vertical;}
.chips{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px;}
.chip{padding:5px 13px;border-radius:20px;font-size:12px;cursor:pointer;border:1px solid var(--bd);color:var(--mu);background:var(--s1);transition:all .15s;font-weight:500;}
.chip:hover{border-color:var(--blue);color:var(--tx);}
.chip.active{background:rgba(79,159,255,.15);border-color:var(--blue);color:var(--blue);}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:6px;padding:9px 18px;border-radius:8px;border:none;cursor:pointer;font-size:13px;font-family:inherit;font-weight:600;transition:all .15s;white-space:nowrap;}
.btn:disabled{opacity:.5;cursor:not-allowed;}
.bp{background:var(--blue);color:#fff;}.bp:hover:not(:disabled){background:#3a8fee;}
.bg{background:var(--s2);color:var(--tx);border:1px solid var(--bd);}.bg:hover:not(:disabled){border-color:var(--blue);color:var(--blue);}
.bd-btn{background:rgba(248,113,113,.12);color:var(--red);border:1px solid rgba(248,113,113,.25);}.bd-btn:hover:not(:disabled){background:rgba(248,113,113,.22);}
.bsm{padding:5px 12px;font-size:12px;border-radius:6px;}
.bai{background:linear-gradient(135deg,#4f9fff22,#8b7cf822);color:var(--vio);border:1px solid rgba(139,124,248,.3);}.bai:hover:not(:disabled){background:linear-gradient(135deg,#4f9fff33,#8b7cf833);}

/* UPLOAD */
.upz{border:2px dashed var(--bd2);border-radius:var(--r);padding:52px 32px;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:20px;background:var(--s1);}
.upz:hover,.upz.drag{border-color:var(--blue);background:rgba(79,159,255,.04);}
.up-ico{font-size:46px;margin-bottom:14px;}
.upz h3{font-size:15px;font-weight:600;margin-bottom:8px;}
.upz p{font-size:12px;color:var(--mu);}

/* AI ì²˜ë¦¬ ìƒíƒœ ë°•ìŠ¤ */
.ai-status{background:var(--s2);border:1px solid rgba(139,124,248,.3);border-radius:var(--r);padding:20px;margin-bottom:16px;}
.ai-status-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.ai-status-row:last-child{margin-bottom:0;}
.step-dot{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;}
.step-dot.done{background:rgba(52,211,153,.2);color:var(--grn);}
.step-dot.ing{background:rgba(139,124,248,.2);color:var(--vio);}
.step-dot.wait{background:var(--s3);color:var(--mu);}
.step-txt{font-size:13px;}
.step-txt.mu{color:var(--mu);}

/* PARSED RESULT */
.pcard{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden;margin-bottom:14px;}
.pgrd{display:grid;grid-template-columns:1fr 1fr;gap:14px;padding:20px;}
.pf-l{font-size:11px;color:var(--mu);margin-bottom:4px;}
.pf-v{font-size:14px;font-weight:600;}
.pfull{grid-column:1/-1;}

.aibox{background:var(--s2);border:1px solid rgba(139,124,248,.25);border-radius:var(--r);padding:20px;margin-top:14px;}
.aibox-h{font-size:12px;color:var(--vio);font-family:'JetBrains Mono',monospace;letter-spacing:1px;margin-bottom:14px;}
.aibox-c{font-size:13px;line-height:1.85;white-space:pre-wrap;}

/* PIPELINE */
.board{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;align-items:start;}
.bcol{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden;}
.bcol-h{padding:12px 14px;border-bottom:1px solid var(--bd);display:flex;align-items:center;gap:7px;font-size:12px;font-weight:600;}
.bcol-cnt{margin-left:auto;font-family:'JetBrains Mono',monospace;font-size:11px;background:var(--s2);padding:2px 7px;border-radius:20px;color:var(--mu);}
.bcol-b{padding:10px;display:flex;flex-direction:column;gap:8px;min-height:60px;}
.bcard{background:var(--s2);border-radius:8px;padding:12px;cursor:pointer;border:1px solid var(--bd);transition:border-color .15s,transform .1s;}
.bcard:hover{border-color:var(--bd2);transform:translateY(-1px);}
.bcard-n{font-size:13px;font-weight:600;margin-bottom:3px;}
.bcard-j{font-size:11px;color:var(--mu);}
.bcard-s{font-size:10px;color:var(--mu);margin-top:5px;opacity:.7;}

/* MODAL */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:999;align-items:center;justify-content:center;backdrop-filter:blur(2px);}
.overlay.open{display:flex;}
.modal{background:var(--s1);border:1px solid var(--bd2);border-radius:14px;width:580px;max-width:96vw;max-height:88vh;overflow-y:auto;padding:26px;scrollbar-width:thin;}
.mlg{width:680px;}
.mhd{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px;}
.mhd h2{font-size:15px;font-weight:700;}
.mcl{background:none;border:none;color:var(--mu);font-size:22px;cursor:pointer;line-height:1;padding:2px 6px;border-radius:5px;}
.mcl:hover{color:var(--tx);background:var(--s2);}
.mft{display:flex;gap:10px;justify-content:flex-end;margin-top:22px;padding-top:18px;border-top:1px solid var(--bd);}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.fg{margin-bottom:14px;}
.fg label{display:block;font-size:11px;color:var(--mu);margin-bottom:5px;}
.fg input,.fg select,.fg textarea{width:100%;}

/* DETAIL */
.dsec{margin-bottom:18px;}
.dsec-t{font-size:11px;color:var(--mu);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--bd);}
.dgrd{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.di-l{font-size:11px;color:var(--mu);margin-bottom:3px;}
.di-v{font-size:13px;font-weight:500;}
.dtxt{background:var(--s2);border-radius:8px;padding:14px;font-size:13px;line-height:1.75;white-space:pre-wrap;max-height:200px;overflow-y:auto;}
.scbar{display:flex;gap:8px;align-items:center;margin-top:12px;}
.scbar select{flex:1;}
.hist{display:flex;flex-direction:column;}
.hi{display:flex;gap:12px;padding:9px 0;border-bottom:1px solid var(--bd);font-size:12px;align-items:flex-start;}
.hi:last-child{border-bottom:none;}
.hidot{width:7px;height:7px;border-radius:50%;background:var(--blue);margin-top:4px;flex-shrink:0;}
.hidate{color:var(--mu);font-family:'JetBrains Mono',monospace;font-size:11px;min-width:82px;}

/* SETTINGS */
.sset{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:22px;margin-bottom:16px;max-width:640px;}
.sset h3{font-size:13px;font-weight:600;margin-bottom:4px;}
.sset p{font-size:12px;color:var(--mu);margin-bottom:16px;}

/* UTILS */
.flex{display:flex;}.aic{align-items:center;}.g2{gap:8px;}.g3{gap:12px;}
.mt3{margin-top:12px;}.mt4{margin-top:16px;}.mb3{margin-bottom:12px;}.mb4{margin-bottom:16px;}
.mu-c{color:var(--mu);}.tsm{font-size:12px;}
.empty{text-align:center;padding:48px 20px;color:var(--mu);}
.empty-i{font-size:36px;margin-bottom:10px;}.empty-t{font-size:13px;}

/* TOAST */
#toast{position:fixed;bottom:22px;right:22px;background:var(--s2);border:1px solid var(--bd2);border-radius:10px;padding:12px 18px;font-size:13px;z-index:9999;pointer-events:none;transform:translateY(80px);opacity:0;transition:all .28s cubic-bezier(.34,1.56,.64,1);}
#toast.show{transform:translateY(0);opacity:1;}
#toast.ok{border-color:var(--grn);}
#toast.err{border-color:var(--red);}
.spin{display:inline-block;width:14px;height:14px;border:2px solid rgba(139,124,248,.3);border-top-color:var(--vio);border-radius:50%;animation:sp .65s linear infinite;}
@keyframes sp{to{transform:rotate(360deg)}}

/* API KEY ì—†ì„ ë•Œ ê²½ê³  */
.api-warn{background:rgba(251,191,36,.08);border:1px solid rgba(251,191,36,.3);border-radius:10px;padding:14px 18px;margin-bottom:20px;font-size:13px;color:var(--yel);display:none;}
.api-warn a{color:var(--blue);cursor:pointer;text-decoration:underline;}
</style>
</head>
<body>

<nav id="sb">
  <div class="logo">
    <div class="logo-t">RECRUIT AI</div>
    <div class="logo-s">ì±„ìš© ê´€ë¦¬ ì—ì´ì „íŠ¸</div>
  </div>
  <div class="ns">ë©”ë‰´</div>
  <div class="ni active" data-pg="dashboard"><span class="nico">ğŸ“Š</span>ëŒ€ì‹œë³´ë“œ</div>
  <div class="ni" data-pg="applicants"><span class="nico">ğŸ‘¥</span>ì§€ì›ì ëª©ë¡<span class="ncnt" id="nc">0</span></div>
  <div class="ni" data-pg="upload"><span class="nico">ğŸ“„</span>ì´ë ¥ì„œ ì—…ë¡œë“œ</div>
  <div class="ni" data-pg="pipeline"><span class="nico">ğŸ”„</span>ì±„ìš© íŒŒì´í”„ë¼ì¸</div>
  <div class="ns">ì„¤ì •</div>
  <div class="ni" data-pg="settings"><span class="nico">âš™ï¸</span>ì„¤ì •</div>
  <div class="sbfoot">ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤</div>
</nav>

<div id="main">
  <div id="topbar">
    <div id="ptitle">ëŒ€ì‹œë³´ë“œ</div>
    <button class="btn bg bsm" onclick="exportJSON()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
    <button class="btn bp" onclick="openAddModal()">+ ì§€ì›ì ì¶”ê°€</button>
  </div>
  <div id="content">

    <div class="page active" id="page-dashboard">
      <div class="srow">
        <div class="sc b"><div class="sc-l">ì „ì²´ ì§€ì›ì</div><div class="sc-v" id="s-total">0</div><div class="sc-s">ëˆ„ì  ë“±ë¡</div></div>
        <div class="sc v"><div class="sc-l">ì§„í–‰ì¤‘</div><div class="sc-v" id="s-active">0</div><div class="sc-s">ê²€í† Â·ë©´ì ‘</div></div>
        <div class="sc g"><div class="sc-l">ìµœì¢…í•©ê²©</div><div class="sc-v" id="s-pass">0</div><div class="sc-s">í•©ê²©ë¥  <span id="s-rate">0</span>%</div></div>
        <div class="sc r"><div class="sc-l">ë¶ˆí•©ê²©</div><div class="sc-v" id="s-fail">0</div><div class="sc-s">íƒˆë½</div></div>
      </div>
      <div class="pc">
        <h3>ë‹¨ê³„ë³„ í˜„í™©</h3>
        <div class="ps">
          <div class="psi"><div class="psi-l">ğŸ“‹ ì„œë¥˜ê²€í† </div><div class="psi-n" style="color:var(--blue)" id="ps0">0</div></div>
          <div class="psi"><div class="psi-l">ğŸ¤ 1ì°¨ë©´ì ‘</div><div class="psi-n" style="color:var(--vio)" id="ps1">0</div></div>
          <div class="psi"><div class="psi-l">ğŸ¯ 2ì°¨ë©´ì ‘</div><div class="psi-n" style="color:var(--yel)" id="ps2">0</div></div>
          <div class="psi"><div class="psi-l">âœ… ìµœì¢…í•©ê²©</div><div class="psi-n" style="color:var(--grn)" id="ps3">0</div></div>
          <div class="psi"><div class="psi-l">âŒ ë¶ˆí•©ê²©</div><div class="psi-n" style="color:var(--red)" id="ps4">0</div></div>
        </div>
      </div>
      <div class="card">
        <div class="card-hd"><span class="card-t">ìµœê·¼ ì§€ì›ì</span><button class="btn bg bsm" onclick="goPage('applicants')">ì „ì²´ ë³´ê¸° â†’</button></div>
        <table><thead><tr><th>ì´ë¦„</th><th>ì§€ì› ì§ë¬´</th><th>ì¶œì²˜</th><th>ë‹¨ê³„</th><th>ë“±ë¡ì¼</th></tr></thead><tbody id="dash-tb"></tbody></table>
      </div>
    </div>

    <div class="page" id="page-applicants">
      <div class="fbar">
        <div class="sw"><span class="si">ğŸ”</span><input type="text" id="qs" placeholder="ì´ë¦„, ì§ë¬´, ë©”ëª¨ ê²€ìƒ‰..."></div>
        <select id="qsrc"><option value="">ì „ì²´ ì¶œì²˜</option><option>ì‚¬ëŒì¸</option><option>ì¡ì½”ë¦¬ì•„</option><option>PDFì´ë ¥ì„œ</option><option>ì§ì ‘ì…ë ¥</option></select>
        <select id="qjob"><option value="">ì „ì²´ ì§ë¬´</option></select>
      </div>
      <div class="chips" id="chips">
        <div class="chip active" data-st="">ì „ì²´</div>
        <div class="chip" data-st="ì„œë¥˜ê²€í† ">ğŸ“‹ ì„œë¥˜ê²€í† </div>
        <div class="chip" data-st="1ì°¨ë©´ì ‘">ğŸ¤ 1ì°¨ë©´ì ‘</div>
        <div class="chip" data-st="2ì°¨ë©´ì ‘">ğŸ¯ 2ì°¨ë©´ì ‘</div>
        <div class="chip" data-st="ìµœì¢…í•©ê²©">âœ… ìµœì¢…í•©ê²©</div>
        <div class="chip" data-st="ë¶ˆí•©ê²©">âŒ ë¶ˆí•©ê²©</div>
        <div class="chip" data-st="ë³´ë¥˜">â¸ ë³´ë¥˜</div>
      </div>
      <div class="card">
        <div class="card-hd"><span class="card-t">ì§€ì›ì ëª©ë¡</span><span class="mu-c tsm" id="lcnt"></span></div>
        <table><thead><tr><th>ì´ë¦„</th><th>ì—°ë½ì²˜</th><th>ì§€ì› ì§ë¬´</th><th>ì¶œì²˜</th><th>ë‹¨ê³„</th><th>ë“±ë¡ì¼</th><th style="width:120px">ì•¡ì…˜</th></tr></thead><tbody id="list-tb"></tbody></table>
      </div>
    </div>

    <div class="page" id="page-upload">
      <div class="api-warn" id="api-warn">
        âš ï¸ Gemini API Keyê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. <a onclick="goPage('settings')">ì„¤ì •ì—ì„œ ì…ë ¥</a>í•˜ë©´ AIê°€ PDFë¥¼ ìë™ìœ¼ë¡œ ì½ê³  ì •ë³´ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
      </div>

      <div class="upz" id="upz">
        <div class="up-ico">ğŸ“„</div>
        <h3>ì´ë ¥ì„œë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•´ì„œ ì—…ë¡œë“œ</h3>
        <p style="margin-top:6px">PDF Â· HTML Â· TXT íŒŒì¼ ì§€ì›</p>
        <p style="margin-top:4px">âœ¨ PDFëŠ” Gemini AIê°€ ì§ì ‘ ì½ì–´ì„œ ì •ë³´ë¥¼ ìë™ ì¶”ì¶œí•©ë‹ˆë‹¤</p>
        <input type="file" id="fi" accept=".pdf,.html,.htm,.txt" style="display:none">
      </div>

      <div id="ai-progress" style="display:none">
        <div class="ai-status mb4">
          <div class="ai-status-row">
            <div class="step-dot" id="step1-dot">1</div>
            <div class="step-txt" id="step1-txt">íŒŒì¼ ì½ê¸°</div>
          </div>
          <div class="ai-status-row">
            <div class="step-dot" id="step2-dot">2</div>
            <div class="step-txt" id="step2-txt">Gemini AI ë¶„ì„ ì¤‘...</div>
          </div>
          <div class="ai-status-row">
            <div class="step-dot" id="step3-dot">3</div>
            <div class="step-txt" id="step3-txt">ì •ë³´ ì¶”ì¶œ ì™„ë£Œ</div>
          </div>
        </div>
      </div>

      <div id="upres" style="display:none">
        <div class="pcard">
          <div class="card-hd"><span class="card-t">ì¶”ì¶œëœ ì§€ì›ì ì •ë³´</span><span class="mu-c tsm" id="upfn"></span></div>
          <div class="pgrd" id="pgrd"></div>
        </div>

        <div id="airesbox" style="display:none">
          <div class="aibox">
            <div class="aibox-h">âœ¦ AI ë¶„ì„ ìš”ì•½</div>
            <div class="aibox-c" id="aitext"></div>
          </div>
        </div>

        <div class="flex g2 mt4" style="flex-wrap:wrap">
          <button class="btn bp" onclick="saveFromUpload()">ğŸ’¾ ì§€ì›ìë¡œ ì €ì¥</button>
          <button class="btn bg" onclick="openEditBeforeSave()">âœï¸ ì •ë³´ ìˆ˜ì • í›„ ì €ì¥</button>
          <button class="btn bg" onclick="resetUpload()">ğŸ”„ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>

    <div class="page" id="page-pipeline">
      <div class="board" id="board"></div>
    </div>

    <div class="page" id="page-settings">
      <div class="sset">
        <h3>ğŸ¤– Gemini API ì„¤ì •</h3>
        <p>PDF ì´ë ¥ì„œë¥¼ AIê°€ ì§ì ‘ ì½ì–´ì„œ ì´ë¦„, ì—°ë½ì²˜, ê²½ë ¥ ë“±ì„ ìë™ ì¶”ì¶œí•©ë‹ˆë‹¤.<br>
        <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:var(--blue)">Google AI Studio</a>ì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        <div class="fg"><label>API Key</label><input type="password" id="cak" placeholder="AIza..."></div>
        <div class="fg"><label>ëª¨ë¸ (ì´ë ¥ì„œ ì´ë¯¸ì§€ ì½ê¸° ì§€ì› ëª¨ë¸)</label>
          <select id="cmod">
            <option value="gemini-1.5-flash">gemini-1.5-flash (ë¹ ë¦„ Â· ë¬´ë£Œ Â· ì¶”ì²œ)</option>
            <option value="gemini-2.0-flash">gemini-2.0-flash (ìµœì‹  Â· ë¹ ë¦„)</option>
            <option value="gemini-1.5-pro">gemini-1.5-pro (ì •í™• Â· ìœ ë£Œ)</option>
          </select>
        </div>
        <button class="btn bp" onclick="saveCfg()">ì €ì¥</button>
      </div>
      <div class="sset">
        <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
        <p>ì „ì²´ ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë°±ì—…í•˜ê±°ë‚˜ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <div class="flex g2" style="flex-wrap:wrap">
          <button class="btn bg" onclick="exportJSON()">ğŸ“¤ JSON ë‚´ë³´ë‚´ê¸°</button>
          <button class="btn bg" onclick="document.getElementById('impf').click()">ğŸ“¥ JSON ê°€ì ¸ì˜¤ê¸°</button>
          <button class="btn bd-btn" onclick="clearAll()">ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
        <input type="file" id="impf" accept=".json" style="display:none" onchange="importJSON(event)">
      </div>
      <div class="sset">
        <h3>ğŸ“‹ ì±„ìš© ë‹¨ê³„</h3>
        <p>í˜„ì¬ ì„¤ì •ëœ ì±„ìš© ë‹¨ê³„ ìˆœì„œì…ë‹ˆë‹¤.</p>
        <div class="flex g2" style="flex-wrap:wrap;align-items:center">
          <span class="badge b-ì„œë¥˜ê²€í† ">ğŸ“‹ ì„œë¥˜ê²€í† </span><span class="mu-c">â†’</span>
          <span class="badge b-1ì°¨ë©´ì ‘">ğŸ¤ 1ì°¨ë©´ì ‘</span><span class="mu-c">â†’</span>
          <span class="badge b-2ì°¨ë©´ì ‘">ğŸ¯ 2ì°¨ë©´ì ‘</span><span class="mu-c">â†’</span>
          <span class="badge b-ìµœì¢…í•©ê²©">âœ… ìµœì¢…í•©ê²©</span><span class="mu-c">/</span>
          <span class="badge b-ë¶ˆí•©ê²©">âŒ ë¶ˆí•©ê²©</span>
        </div>
      </div>
    </div>

  </div></div><div class="overlay" id="modal-add">
  <div class="modal">
    <div class="mhd"><h2 id="add-ttl">ì§€ì›ì ì¶”ê°€</h2><button class="mcl" onclick="closeModal('modal-add')">Ã—</button></div>
    <input type="hidden" id="eid">
    <div class="frow">
      <div class="fg"><label>ì´ë¦„ *</label><input type="text" id="fn" placeholder="í™ê¸¸ë™"></div>
      <div class="fg"><label>ì—°ë½ì²˜</label><input type="text" id="fph" placeholder="010-0000-0000"></div>
      <div class="fg"><label>ì´ë©”ì¼</label><input type="email" id="fem" placeholder="email@example.com"></div>
      <div class="fg"><label>ì§€ì› ì§ë¬´</label><input type="text" id="fj" placeholder="ì˜ì—…íŒ€ì¥, ê°œë°œì ë“±"></div>
      <div class="fg"><label>ì¶œì²˜</label>
        <select id="fsrc"><option>ì§ì ‘ì…ë ¥</option><option>ì‚¬ëŒì¸</option><option>ì¡ì½”ë¦¬ì•„</option><option>PDFì´ë ¥ì„œ</option></select>
      </div>
      <div class="fg"><label>ì±„ìš© ë‹¨ê³„</label>
        <select id="fst"><option>ì„œë¥˜ê²€í† </option><option>1ì°¨ë©´ì ‘</option><option>2ì°¨ë©´ì ‘</option><option>ìµœì¢…í•©ê²©</option><option>ë¶ˆí•©ê²©</option><option>ë³´ë¥˜</option></select>
      </div>
    </div>
    <div class="fg"><label>ê²½ë ¥ / í•™ë ¥ / AI ìš”ì•½</label><textarea id="fca" rows="5" placeholder="ê²½ë ¥, í•™ë ¥, AI ë¶„ì„ ê²°ê³¼..."></textarea></div>
    <div class="fg"><label>ë©”ëª¨</label><textarea id="fmo" rows="3" placeholder="ë©´ì ‘ í”¼ë“œë°±, íŠ¹ì´ì‚¬í•­..."></textarea></div>
    <div class="mft"><button class="btn bg" onclick="closeModal('modal-add')">ì·¨ì†Œ</button><button class="btn bp" onclick="saveApplicant()">ì €ì¥</button></div>
  </div>
</div>

<div class="overlay" id="modal-det">
  <div class="modal mlg">
    <div class="mhd"><h2 id="det-name">ìƒì„¸</h2><button class="mcl" onclick="closeModal('modal-det')">Ã—</button></div>
    <div id="det-body"></div>
    <div class="mft">
      <button class="btn bd-btn bsm" id="det-del">ğŸ—‘ï¸ ì‚­ì œ</button>
      <button class="btn bg" onclick="closeModal('modal-det')">ë‹«ê¸°</button>
      <button class="btn bp" id="det-edit">âœï¸ ìˆ˜ì •</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
/* â•â•â• STATE â•â•â• */
let DB  = JSON.parse(localStorage.getItem('rma4') || '[]');
let CFG = JSON.parse(localStorage.getItem('rma4c') || '{"ak":"","m":"gemini-1.5-flash"}');
let upData  = null;  // ì—…ë¡œë“œëœ íŒŒì‹± ê²°ê³¼
let detId   = null;
let stFilt  = '';

/* â•â•â• PERSIST â•â•â• */
function save(){
  localStorage.setItem('rma4', JSON.stringify(DB));
  document.getElementById('nc').textContent = DB.length;
}

/* â•â•â• NAVIGATION â•â•â• */
document.querySelectorAll('.ni[data-pg]').forEach(el => {
  el.addEventListener('click', function(){ goPage(this.dataset.pg); });
});

const TITLES = { dashboard:'ëŒ€ì‹œë³´ë“œ', applicants:'ì§€ì›ì ëª©ë¡', upload:'ì´ë ¥ì„œ ì—…ë¡œë“œ', pipeline:'ì±„ìš© íŒŒì´í”„ë¼ì¸', settings:'ì„¤ì •' };

function goPage(pg){
  document.querySelectorAll('.ni').forEach(n => n.classList.remove('active'));
  const nav = document.querySelector('.ni[data-pg="'+pg+'"]');
  if(nav) nav.classList.add('active');
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-'+pg).classList.add('active');
  document.getElementById('ptitle').textContent = TITLES[pg] || pg;

  if(pg==='dashboard') renderDash();
  if(pg==='applicants'){ fillJobFilter(); renderList(); }
  if(pg==='pipeline') renderPipe();
  if(pg==='upload'){
    document.getElementById('api-warn').style.display = CFG.ak ? 'none' : 'block';
  }
}

/* â•â•â• HELPERS â•â•â• */
const uid    = () => Date.now().toString(36)+Math.random().toString(36).slice(2,5);
const todayS = () => new Date().toLocaleDateString('ko-KR');
const fmtD   = ts => new Date(ts).toLocaleDateString('ko-KR');

function badge(s){
  const e = {'ì„œë¥˜ê²€í† ':'ğŸ“‹','1ì°¨ë©´ì ‘':'ğŸ¤','2ì°¨ë©´ì ‘':'ğŸ¯','ìµœì¢…í•©ê²©':'âœ…','ë¶ˆí•©ê²©':'âŒ','ë³´ë¥˜':'â¸'}[s]||'';
  return `<span class="badge b-${s}">${e} ${s}</span>`;
}

/* â•â•â• DASHBOARD â•â•â• */
function renderDash(){
  const total = DB.length;
  const pass  = DB.filter(a=>a.stage==='ìµœì¢…í•©ê²©').length;
  const fail  = DB.filter(a=>a.stage==='ë¶ˆí•©ê²©').length;
  document.getElementById('s-total').textContent  = total;
  document.getElementById('s-active').textContent = total-pass-fail;
  document.getElementById('s-pass').textContent   = pass;
  document.getElementById('s-fail').textContent   = fail;
  document.getElementById('s-rate').textContent   = total ? Math.round(pass/total*100) : 0;

  ['ì„œë¥˜ê²€í† ','1ì°¨ë©´ì ‘','2ì°¨ë©´ì ‘','ìµœì¢…í•©ê²©','ë¶ˆí•©ê²©'].forEach((s,i)=>{
    const el=document.getElementById('ps'+i); if(el) el.textContent=DB.filter(a=>a.stage===s).length;
  });

  const recent=[...DB].sort((a,b)=>b.ts-a.ts).slice(0,6);
  const tb=document.getElementById('dash-tb');
  tb.innerHTML = recent.length ? recent.map(a=>`
    <tr onclick="openDetail('${a.id}')">
      <td><strong>${a.name}</strong></td>
      <td>${a.job||'-'}</td><td>${a.source||'-'}</td>
      <td>${badge(a.stage)}</td>
      <td class="mu-c tsm">${fmtD(a.ts)}</td>
    </tr>`).join('') :
    `<tr><td colspan="5"><div class="empty"><div class="empty-i">ğŸ“­</div><div class="empty-t">ë“±ë¡ëœ ì§€ì›ìê°€ ì—†ìŠµë‹ˆë‹¤</div></div></td></tr>`;
  document.getElementById('nc').textContent = DB.length;
}

/* â•â•â• LIST â•â•â• */
function fillJobFilter(){
  const jobs=[...new Set(DB.map(a=>a.job).filter(Boolean))];
  document.getElementById('qjob').innerHTML='<option value="">ì „ì²´ ì§ë¬´</option>'+jobs.map(j=>`<option>${j}</option>`).join('');
}

function renderList(){
  const q=document.getElementById('qs').value.toLowerCase();
  const src=document.getElementById('qsrc').value;
  const job=document.getElementById('qjob').value;
  let list=[...DB];
  if(q) list=list.filter(a=>a.name.toLowerCase().includes(q)||(a.job||'').toLowerCase().includes(q)||(a.memo||'').toLowerCase().includes(q)||(a.career||'').toLowerCase().includes(q));
  if(src) list=list.filter(a=>a.source===src);
  if(job) list=list.filter(a=>a.job===job);
  if(stFilt) list=list.filter(a=>a.stage===stFilt);
  list.sort((a,b)=>b.ts-a.ts);
  document.getElementById('lcnt').textContent=list.length+'ëª…';
  const tb=document.getElementById('list-tb');
  tb.innerHTML=list.length?list.map(a=>`
    <tr>
      <td><strong style="cursor:pointer;color:var(--blue)" onclick="openDetail('${a.id}')">${a.name}</strong></td>
      <td class="mu-c">${a.phone||'-'}</td>
      <td>${a.job||'-'}</td><td>${a.source||'-'}</td>
      <td>${badge(a.stage)}</td>
      <td class="mu-c tsm">${fmtD(a.ts)}</td>
      <td><div class="flex g2">
        <button class="btn bg bsm" onclick="openEdit('${a.id}')">ìˆ˜ì •</button>
        <button class="btn bd-btn bsm" onclick="delApp('${a.id}')">ì‚­ì œ</button>
      </div></td>
    </tr>`).join(''):
    `<tr><td colspan="7"><div class="empty"><div class="empty-i">ğŸ”</div><div class="empty-t">ì¡°ê±´ì— ë§ëŠ” ì§€ì›ìê°€ ì—†ìŠµë‹ˆë‹¤</div></div></td></tr>`;
}

document.getElementById('qs').addEventListener('input', renderList);
document.getElementById('qsrc').addEventListener('change', renderList);
document.getElementById('qjob').addEventListener('change', renderList);
document.querySelectorAll('#chips .chip').forEach(c=>{
  c.addEventListener('click', function(){
    document.querySelectorAll('#chips .chip').forEach(x=>x.classList.remove('active'));
    this.classList.add('active'); stFilt=this.dataset.st; renderList();
  });
});

/* â•â•â• PIPELINE â•â•â• */
function renderPipe(){
  const STAGES=[
    {k:'ì„œë¥˜ê²€í† ',c:'var(--blue)',e:'ğŸ“‹'},{k:'1ì°¨ë©´ì ‘',c:'var(--vio)',e:'ğŸ¤'},
    {k:'2ì°¨ë©´ì ‘',c:'var(--yel)',e:'ğŸ¯'},{k:'ìµœì¢…í•©ê²©',c:'var(--grn)',e:'âœ…'},
    {k:'ë¶ˆí•©ê²©',c:'var(--red)',e:'âŒ'},
  ];
  document.getElementById('board').innerHTML=STAGES.map(s=>{
    const cards=DB.filter(a=>a.stage===s.k);
    return `<div class="bcol">
      <div class="bcol-h" style="color:${s.c}">${s.e} ${s.k}<span class="bcol-cnt">${cards.length}</span></div>
      <div class="bcol-b">${cards.length?cards.map(a=>`
        <div class="bcard" onclick="openDetail('${a.id}')">
          <div class="bcard-n">${a.name}</div>
          <div class="bcard-j">${a.job||'-'}</div>
          <div class="bcard-s">${a.source||''}</div>
        </div>`).join(''):'<div class="mu-c tsm" style="text-align:center;padding:16px">ì—†ìŒ</div>'}
      </div></div>`;
  }).join('');
}

/* â•â•â• ADD / EDIT â•â•â• */
function openAddModal(){
  document.getElementById('add-ttl').textContent='ì§€ì›ì ì¶”ê°€';
  document.getElementById('eid').value='';
  ['fn','fph','fem','fj','fca','fmo'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('fsrc').value='ì§ì ‘ì…ë ¥';
  document.getElementById('fst').value='ì„œë¥˜ê²€í† ';
  openModal('modal-add');
}

function openEdit(id){
  const a=DB.find(x=>x.id===id); if(!a) return;
  closeModal('modal-det');
  document.getElementById('add-ttl').textContent='ì§€ì›ì ìˆ˜ì •';
  document.getElementById('eid').value=id;
  document.getElementById('fn').value=a.name||'';
  document.getElementById('fph').value=a.phone||'';
  document.getElementById('fem').value=a.email||'';
  document.getElementById('fj').value=a.job||'';
  document.getElementById('fsrc').value=a.source||'ì§ì ‘ì…ë ¥';
  document.getElementById('fst').value=a.stage||'ì„œë¥˜ê²€í† ';
  document.getElementById('fca').value=a.career||'';
  document.getElementById('fmo').value=a.memo||'';
  openModal('modal-add');
}

function openEditBeforeSave(){
  if(!upData) return;
  document.getElementById('add-ttl').textContent='ì§€ì›ì ì •ë³´ í™•ì¸ Â· ìˆ˜ì •';
  document.getElementById('eid').value='';
  document.getElementById('fn').value=upData.name||'';
  document.getElementById('fph').value=upData.phone||'';
  document.getElementById('fem').value=upData.email||'';
  document.getElementById('fj').value=upData.job||'';
  document.getElementById('fsrc').value=upData.source||'PDFì´ë ¥ì„œ';
  document.getElementById('fst').value='ì„œë¥˜ê²€í† ';
  document.getElementById('fca').value=upData.career||'';
  document.getElementById('fmo').value='';
  openModal('modal-add');
}

function saveApplicant(){
  const name=document.getElementById('fn').value.trim();
  if(!name){ toast('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”','err'); return; }
  const id=document.getElementById('eid').value;
  const nst=document.getElementById('fst').value;
  const d={
    name, job:document.getElementById('fj').value.trim(),
    phone:document.getElementById('fph').value.trim(),
    email:document.getElementById('fem').value.trim(),
    source:document.getElementById('fsrc').value, stage:nst,
    career:document.getElementById('fca').value.trim(),
    memo:document.getElementById('fmo').value.trim(),
  };
  if(id){
    const idx=DB.findIndex(a=>a.id===id); const old=DB[idx];
    const hist=old.history||[];
    if(old.stage!==nst) hist.push({date:todayS(),msg:`ë‹¨ê³„ ë³€ê²½: ${old.stage} â†’ ${nst}`});
    hist.push({date:todayS(),msg:'ì •ë³´ ìˆ˜ì •'});
    d.id=id; d.ts=old.ts; d.history=hist; DB[idx]=d; toast('ìˆ˜ì • ì™„ë£Œ!','ok');
  } else {
    d.id=uid(); d.ts=Date.now();
    d.history=[{date:todayS(),msg:'ì§€ì›ì ë“±ë¡'+(upData?` (${upData.source} ì—…ë¡œë“œ)`:'')}];
    DB.push(d); toast('ì €ì¥ ì™„ë£Œ!','ok');
    upData=null; 
  }
  save(); closeModal('modal-add'); renderDash();
  if(document.getElementById('page-applicants').classList.contains('active')) renderList();
}

/* â•â•â• DETAIL â•â•â• */
function openDetail(id){
  const a=DB.find(x=>x.id===id); if(!a) return;
  detId=id;
  document.getElementById('det-name').textContent=a.name;
  document.getElementById('det-body').innerHTML=`
    <div class="dsec">
      <div class="dsec-t">ê¸°ë³¸ ì •ë³´</div>
      <div class="dgrd">
        <div><div class="di-l">ì§€ì› ì§ë¬´</div><div class="di-v">${a.job||'-'}</div></div>
        <div><div class="di-l">ì±„ìš© ë‹¨ê³„</div><div class="di-v">${badge(a.stage)}</div></div>
        <div><div class="di-l">ì—°ë½ì²˜</div><div class="di-v">${a.phone||'-'}</div></div>
        <div><div class="di-l">ì´ë©”ì¼</div><div class="di-v">${a.email||'-'}</div></div>
        <div><div class="di-l">ì¶œì²˜</div><div class="di-v">${a.source||'-'}</div></div>
        <div><div class="di-l">ë“±ë¡ì¼</div><div class="di-v">${fmtD(a.ts)}</div></div>
      </div>
      <div class="scbar mt3">
        <span class="mu-c tsm">ë‹¨ê³„ ë³€ê²½:</span>
        <select id="dstsel"><option>ì„œë¥˜ê²€í† </option><option>1ì°¨ë©´ì ‘</option><option>2ì°¨ë©´ì ‘</option><option>ìµœì¢…í•©ê²©</option><option>ë¶ˆí•©ê²©</option><option>ë³´ë¥˜</option></select>
        <button class="btn bg bsm" onclick="changeSt()">ë³€ê²½</button>
      </div>
    </div>
    ${a.career?`<div class="dsec"><div class="dsec-t">ê²½ë ¥ / AI ìš”ì•½</div><div class="dtxt">${a.career}</div></div>`:''}
    ${a.memo?`<div class="dsec"><div class="dsec-t">ë©”ëª¨</div><div class="dtxt">${a.memo}</div></div>`:''}
    <div class="dsec">
      <div class="dsec-t">ì§„í–‰ íˆìŠ¤í† ë¦¬</div>
      <div class="hist">${(a.history||[]).slice().reverse().map(h=>`
        <div class="hi"><div class="hidot"></div><div class="hidate">${h.date}</div><div>${h.msg}</div></div>`).join('')||'<div class="mu-c tsm">ê¸°ë¡ ì—†ìŒ</div>'}
      </div>
    </div>`;
  setTimeout(()=>{ const s=document.getElementById('dstsel'); if(s) s.value=a.stage; },10);
  document.getElementById('det-edit').onclick=()=>openEdit(id);
  document.getElementById('det-del').onclick=()=>delApp(id);
  openModal('modal-det');
}

function changeSt(){
  const sel=document.getElementById('dstsel'); if(!sel||!detId) return;
  const ns=sel.value;
  const idx=DB.findIndex(a=>a.id===detId); if(idx<0) return;
  const old=DB[idx];
  if(old.stage===ns){ toast('ì´ë¯¸ ê°™ì€ ë‹¨ê³„ì…ë‹ˆë‹¤',''); return; }
  old.history=old.history||[];
  old.history.push({date:todayS(),msg:`ë‹¨ê³„ ë³€ê²½: ${old.stage} â†’ ${ns}`});
  old.stage=ns;
  save(); closeModal('modal-det'); openDetail(detId); renderDash();
  toast(ns+'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤','ok');
}

function delApp(id){
  if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  DB=DB.filter(a=>a.id!==id); save(); closeModal('modal-det'); renderDash();
  if(document.getElementById('page-applicants').classList.contains('active')) renderList();
  toast('ì‚­ì œ ì™„ë£Œ','ok');
}

/* â•â•â• UPLOAD (Gemini Vision) â•â•â• */
const upz=document.getElementById('upz');
const fi=document.getElementById('fi');
upz.addEventListener('click',()=>fi.click());
fi.addEventListener('change',e=>{ if(e.target.files[0]) handleFile(e.target.files[0]); });
upz.addEventListener('dragover',e=>{ e.preventDefault(); upz.classList.add('drag'); });
upz.addEventListener('dragleave',()=>upz.classList.remove('drag'));
upz.addEventListener('drop',e=>{ e.preventDefault(); upz.classList.remove('drag'); if(e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]); });

function setStep(n, state, txt){
  const dot=document.getElementById('step'+n+'-dot');
  const t=document.getElementById('step'+n+'-txt');
  dot.className='step-dot '+state;
  dot.textContent = state==='done'?'âœ“':state==='ing'?'âŸ³':n;
  if(txt){ t.textContent=txt; t.className='step-txt'+(state==='wait'?' mu':''); }
}

async function handleFile(file){
  document.getElementById('upfn').textContent=file.name;
  document.getElementById('upres').style.display='none';
  document.getElementById('ai-progress').style.display='block';
  setStep(1,'ing','íŒŒì¼ ì½ëŠ” ì¤‘...');
  setStep(2,'wait','AI ë¶„ì„ ëŒ€ê¸°');
  setStep(3,'wait','ì™„ë£Œ ëŒ€ê¸°');

  const b64 = await fileToBase64(file);
  const mime = file.name.endsWith('.pdf') ? 'application/pdf' : file.type || 'text/plain';
  setStep(1,'done','íŒŒì¼ ì½ê¸° ì™„ë£Œ');

  if(!CFG.ak){
    setStep(2,'wait','API Key ì—†ìŒ (ê¸°ë³¸ íŒŒì‹± ì‚¬ìš©)');
    setStep(3,'ing','í…ìŠ¤íŠ¸ ì¶”ì¶œ ì¤‘...');
    let text='';
    try{ text = atob(b64); } catch(e){ text=''; }
    const parsed = parseTextBasic(text, file.name);
    upData={...parsed, career:''};
    showParsedResult(upData);
    setStep(3,'done','ê¸°ë³¸ íŒŒì‹± ì™„ë£Œ (AI ë¶„ì„ ì—†ìŒ)');
    toast('API Keyë¥¼ ì„¤ì •í•˜ë©´ ë” ì •í™•í•˜ê²Œ ì½ìŠµë‹ˆë‹¤','');
    return;
  }

  setStep(2,'ing','Gemini AIê°€ ì´ë ¥ì„œ ë¶„ì„ ì¤‘...');

  try{
    const result = await callGeminiVision(b64, mime);
    setStep(2,'done','AI ë¶„ì„ ì™„ë£Œ');
    setStep(3,'ing','ì •ë³´ ì •ë¦¬ ì¤‘...');

    let parsed;
    try{
      const jsonStr = result.replace(/```json\n?/g,'').replace(/```\n?/g,'').trim();
      parsed = JSON.parse(jsonStr);
    } catch(e){
      parsed = extractFromText(result);
      parsed.career = result;
    }

    upData = {
      name:   parsed.ì´ë¦„||parsed.name||'',
      phone:  parsed.ì—°ë½ì²˜||parsed.phone||'',
      email:  parsed.ì´ë©”ì¼||parsed.email||'',
      job:    parsed.ì§€ì›ì§ë¬´||parsed.job||'',
      source: 'PDFì´ë ¥ì„œ',
      career: parsed.ê²½ë ¥ìš”ì•½||parsed.career||result,
      aiSummary: parsed.AIìš”ì•½||parsed.summary||result,
    };

    showParsedResult(upData);
    setStep(3,'done','ì¶”ì¶œ ì™„ë£Œ');
    toast('AI ë¶„ì„ ì™„ë£Œ!','ok');

  } catch(e){
    setStep(2,'wait','AI ì˜¤ë¥˜: '+e.message);
    toast('AI ì˜¤ë¥˜: '+e.message,'err');
  }
}

// ğŸ‰ ë”± ì´ ë¶€ë¶„ë§Œ ìˆ˜ì •í•œ ì™„ë²½í•œ ì›ë³¸ ë³µêµ¬ ì½”ë“œì…ë‹ˆë‹¤!
async function callGeminiVision(b64, mime){
  let modelName = CFG.m || 'gemini-1.5-flash';
  if (!modelName.startsWith('models/')) {
    modelName = `models/${modelName}`;
  }

  const prompt = `ì´ ì´ë ¥ì„œ ë¬¸ì„œë¥¼ ë¶„ì„í•˜ê³  ë‹¤ìŒ ì •ë³´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œë§Œ ë‹µí•´ì£¼ì„¸ìš”. ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´ JSONë§Œ ë°˜í™˜í•˜ì„¸ìš”.\n\n{\n  "ì´ë¦„": "ì‹¤ì œ ì´ë¦„",\n  "ì—°ë½ì²˜": "ì „í™”ë²ˆí˜¸",\n  "ì´ë©”ì¼": "ì´ë©”ì¼ì£¼ì†Œ",\n  "ìƒë…„ì›”ì¼": "ìƒë…„ì›”ì¼",\n  "ì£¼ì†Œ": "ì£¼ì†Œ",\n  "ì§€ì›ì§ë¬´": "ì§€ì›í•˜ëŠ” ì§ë¬´/ë¶€ë¬¸",\n  "í•™ë ¥": "ìµœì¢…í•™ë ¥ ìš”ì•½",\n  "ê²½ë ¥ìš”ì•½": "ì£¼ìš” ê²½ë ¥ ì „ì²´ ìš”ì•½ (íšŒì‚¬ëª…, ê¸°ê°„, ì§ìœ„, ë‹´ë‹¹ì—…ë¬´ í¬í•¨)",\n  "í•µì‹¬ê¸°ìˆ ": "ë³´ìœ  ê¸°ìˆ , ìê²©ì¦, ì™¸êµ­ì–´ ëŠ¥ë ¥",\n  "ê°•ì ": "ì´ ì§€ì›ìì˜ ê°•ì  3ê°€ì§€",\n  "íŠ¹ì´ì‚¬í•­": "ë¹„ì, íŠ¹ì´ì‚¬í•­, ë©´ì ‘ì¼ì§€ ë“±",\n  "AIìš”ì•½": "ì „ì²´ ìš”ì•½ ë° ì„œë¥˜ í†µê³¼ ì¶”ì²œ ì—¬ë¶€"\n}`;

  // v1beta ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ v1ìœ¼ë¡œ ë³€ê²½í•˜ì˜€ìœ¼ë©°, JSON ê°•ì œ ì¶œë ¥ ì˜µì…˜ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
  const resp = await fetch(
    `https://generativelanguage.googleapis.com/v1/${modelName}:generateContent?key=${CFG.ak}`,
    {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        contents:[{
          parts:[
            { inline_data:{ mime_type: mime, data: b64 } },
            { text: prompt }
          ]
        }],
        generationConfig: {
          response_mime_type: "application/json"
        }
      })
    }
  );
  
  const data = await resp.json();
  if(data.error) throw new Error(data.error.message);
  return data?.candidates?.[0]?.content?.parts?.[0]?.text || '';
}

function showParsedResult(d){
  document.getElementById('pgrd').innerHTML=`
    <div><div class="pf-l">ì´ë¦„</div><div class="pf-v" style="color:var(--blue)">${d.name||'ë¯¸ê°ì§€'}</div></div>
    <div><div class="pf-l">ì—°ë½ì²˜</div><div class="pf-v">${d.phone||'ë¯¸ê°ì§€'}</div></div>
    <div><div class="pf-l">ì´ë©”ì¼</div><div class="pf-v">${d.email||'ë¯¸ê°ì§€'}</div></div>
    <div><div class="pf-l">ì§€ì› ì§ë¬´</div><div class="pf-v">${d.job||'ë¯¸ê°ì§€'}</div></div>
    <div><div class="pf-l">ì¶œì²˜</div><div class="pf-v">${d.source||'-'}</div></div>
    ${d.aiSummary?`<div class="pfull">
      <div class="aibox mt3"><div class="aibox-h">âœ¦ AI ë¶„ì„ ìš”ì•½</div><div class="aibox-c">${d.aiSummary}</div></div>
    </div>`:''}
  `;
  document.getElementById('upres').style.display='block';
}

function fileToBase64(file){
  return new Promise((res,rej)=>{
    const r=new FileReader();
    r.onload=e=>res(e.target.result.split(',')[1]);
    r.onerror=rej;
    r.readAsDataURL(file);
  });
}

function parseTextBasic(text, fname){
  const low=(text+fname).toLowerCase();
  const src=low.includes('saramin')||low.includes('ì‚¬ëŒì¸')?'ì‚¬ëŒì¸':low.includes('jobkorea')||low.includes('ì¡ì½”ë¦¬ì•„')?'ì¡ì½”ë¦¬ì•„':fname.endsWith('.pdf')?'PDFì´ë ¥ì„œ':'ì§ì ‘ì…ë ¥';
  return {
    name: (text.match(/(?:ì´ë¦„|ì„±ëª…)\s*[:ï¼š]?\s*([ê°€-í£]{2,5})/)||[])[1]||'',
    phone:(text.match(/0\d{1,2}[-.\s]?\d{3,4}[-.\s]?\d{4}/)||[])[0]||'',
    email:(text.match(/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}/)||[])[0]||'',
    source:src, job:'',
  };
}

function extractFromText(text){
  const get=(labels)=>{
    for(const l of labels){
      const m=text.match(new RegExp(l+'[\\s:ï¼š]+([^\\n]+)'));
      if(m) return m[1].trim();
    }
    return '';
  };
  return {
    ì´ë¦„: get(['ì´ë¦„','ì„±ëª…','name']),
    ì—°ë½ì²˜: (text.match(/0\d{1,2}[-.\s]?\d{3,4}[-.\s]?\d{4}/)||[])[0]||'',
    ì´ë©”ì¼: (text.match(/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}/)||[])[0]||'',
    ì§€ì›ì§ë¬´: get(['ì§€ì›ì§ë¬´','ì§€ì›ë¶„ì•¼','ì§€ì› ì§ë¬´']),
  };
}

function saveFromUpload(){
  if(!upData) return;
  DB.push({
    id:uid(), ts:Date.now(),
    name:upData.name||'ì´ë¦„ ë¯¸ìƒ',
    phone:upData.phone||'', email:upData.email||'',
    source:upData.source||'PDFì´ë ¥ì„œ', stage:'ì„œë¥˜ê²€í† ',
    job:upData.job||'',
    career:upData.career||upData.aiSummary||'',
    memo:'',
    history:[{date:todayS(),msg:`ì´ë ¥ì„œ ì—…ë¡œë“œ ë“±ë¡ (${upData.source||'PDFì´ë ¥ì„œ'})`}],
  });
  save(); resetUpload(); renderDash();
  toast('ì§€ì›ìë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!','ok');
  goPage('applicants');
}

function resetUpload(){
  upData=null;
  document.getElementById('upres').style.display='none';
  document.getElementById('ai-progress').style.display='none';
  fi.value='';
}

/* â•â•â• SETTINGS â•â•â• */
document.getElementById('cak').value=CFG.ak||'';
document.getElementById('cmod').value=CFG.m||'gemini-1.5-flash';

function saveCfg(){
  CFG.ak=document.getElementById('cak').value.trim();
  CFG.m=document.getElementById('cmod').value;
  localStorage.setItem('rma4c',JSON.stringify(CFG));
  toast('ì„¤ì • ì €ì¥ ì™„ë£Œ!','ok');
}

function exportJSON(){
  const blob=new Blob([JSON.stringify({v:4,applicants:DB},null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download='recruit_'+new Date().toISOString().slice(0,10)+'.json'; a.click();
}

function importJSON(e){
  const file=e.target.files[0]; if(!file) return;
  const r=new FileReader();
  r.onload=ev=>{
    try{
      const d=JSON.parse(ev.target.result);
      if(d.applicants){ DB=d.applicants; save(); renderDash(); toast('ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!','ok'); }
      else toast('ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤','err');
    } catch{ toast('íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜','err'); }
  };
  r.readAsText(file);
}

function clearAll(){
  if(!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆê¹Œ? ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
  DB=[]; save(); renderDash(); toast('ì´ˆê¸°í™” ì™„ë£Œ','ok');
}

/* â•â•â• MODAL â•â•â• */
function openModal(id){ document.getElementById(id).classList.add('open'); }
function closeModal(id){ document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.overlay').forEach(el=>{
  el.addEventListener('click',e=>{ if(e.target===el) el.classList.remove('open'); });
});

/* â•â•â• TOAST â•â•â• */
function toast(msg,type){
  const el=document.getElementById('toast');
  el.textContent=msg; el.className='toast show'+(type?' '+type:'');
  clearTimeout(el._t); el._t=setTimeout(()=>{ el.className='toast'; },2800);
}

/* â•â•â• INIT â•â•â• */
renderDash();
document.getElementById('nc').textContent=DB.length;
</script>
</body>
</html>
