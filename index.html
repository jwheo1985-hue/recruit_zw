<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì±„ìš© ê´€ë¦¬ ì—ì´ì „íŠ¸</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Space+Mono:wght@400;700&display=swap');

  :root {
    --bg: #0d0f14;
    --surface: #161920;
    --surface2: #1e2230;
    --border: #2a2f3d;
    --accent: #4f9fff;
    --accent2: #7c4dff;
    --green: #2ecc71;
    --yellow: #f39c12;
    --red: #e74c3c;
    --text: #e8eaf0;
    --text-muted: #7a8099;
    --radius: 10px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  /* â”€â”€â”€ SIDEBAR â”€â”€â”€ */
  #sidebar {
    width: 220px;
    min-width: 220px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    padding: 0;
  }

  .sidebar-logo {
    padding: 24px 20px 20px;
    border-bottom: 1px solid var(--border);
  }

  .sidebar-logo h1 {
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    color: var(--accent);
    letter-spacing: 1px;
  }

  .sidebar-logo p {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 4px;
  }

  .nav-section {
    padding: 16px 12px 8px;
    font-size: 10px;
    color: var(--text-muted);
    letter-spacing: 1.5px;
    text-transform: uppercase;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
    margin: 2px 8px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    color: var(--text-muted);
    transition: all 0.15s ease;
    user-select: none;
  }

  .nav-item:hover {
    background: var(--surface2);
    color: var(--text);
  }

  .nav-item.active {
    background: rgba(79, 159, 255, 0.15);
    color: var(--accent);
  }

  .nav-item .icon { font-size: 16px; width: 20px; text-align: center; }

  .nav-badge {
    margin-left: auto;
    background: var(--accent);
    color: #fff;
    font-size: 10px;
    padding: 1px 7px;
    border-radius: 20px;
    font-family: 'Space Mono', monospace;
  }

  /* â”€â”€â”€ MAIN CONTENT â”€â”€â”€ */
  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  #topbar {
    height: 60px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 28px;
    gap: 16px;
    background: var(--surface);
  }

  #page-title {
    font-size: 16px;
    font-weight: 700;
    flex: 1;
  }

  #content {
    flex: 1;
    overflow-y: auto;
    padding: 28px;
  }

  /* â”€â”€â”€ PAGE SECTIONS (hidden by default) â”€â”€â”€ */
  .page { display: none; }
  .page.active { display: block; }

  /* â”€â”€â”€ DASHBOARD â”€â”€â”€ */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 28px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
  }

  .stat-card .label { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }
  .stat-card .value { font-size: 28px; font-weight: 700; font-family: 'Space Mono', monospace; }
  .stat-card .value.blue { color: var(--accent); }
  .stat-card .value.green { color: var(--green); }
  .stat-card .value.yellow { color: var(--yellow); }
  .stat-card .value.red { color: var(--red); }

  .pipeline-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 20px;
  }

  .pipeline-section h3 { font-size: 14px; margin-bottom: 20px; color: var(--text-muted); }

  .pipeline-stages {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 12px;
  }

  .pipeline-stage {
    background: var(--surface2);
    border-radius: 8px;
    padding: 16px;
    text-align: center;
  }

  .pipeline-stage .stage-name { font-size: 11px; color: var(--text-muted); margin-bottom: 8px; }
  .pipeline-stage .stage-count { font-size: 24px; font-weight: 700; font-family: 'Space Mono', monospace; }

  /* â”€â”€â”€ TABLE â”€â”€â”€ */
  .table-wrapper {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .table-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
  }

  .table-header h3 { font-size: 14px; }

  table { width: 100%; border-collapse: collapse; }
  th { background: var(--surface2); font-size: 12px; color: var(--text-muted); padding: 12px 16px; text-align: left; font-weight: 500; }
  td { padding: 12px 16px; font-size: 13px; border-bottom: 1px solid var(--border); }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: rgba(255,255,255,0.02); }

  /* â”€â”€â”€ BADGE â”€â”€â”€ */
  .badge {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 500;
  }

  .badge.ì„œë¥˜ê²€í†  { background: rgba(79,159,255,0.2); color: var(--accent); }
  .badge.1ì°¨ë©´ì ‘ { background: rgba(124,77,255,0.2); color: #9c7fff; }
  .badge.2ì°¨ë©´ì ‘ { background: rgba(243,156,18,0.2); color: var(--yellow); }
  .badge.ìµœì¢…í•©ê²© { background: rgba(46,204,113,0.2); color: var(--green); }
  .badge.ë¶ˆí•©ê²©  { background: rgba(231,76,60,0.2); color: var(--red); }
  .badge.ë³´ë¥˜    { background: rgba(122,128,153,0.2); color: var(--text-muted); }

  /* â”€â”€â”€ UPLOAD AREA â”€â”€â”€ */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: var(--radius);
    padding: 48px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 24px;
  }

  .upload-zone:hover, .upload-zone.dragover {
    border-color: var(--accent);
    background: rgba(79,159,255,0.05);
  }

  .upload-zone .upload-icon { font-size: 48px; margin-bottom: 12px; }
  .upload-zone h3 { font-size: 16px; margin-bottom: 8px; }
  .upload-zone p { font-size: 13px; color: var(--text-muted); }

  /* â”€â”€â”€ FORM â”€â”€â”€ */
  .form-group { margin-bottom: 16px; }
  .form-group label { display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 6px; }
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-size: 13px;
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    border-color: var(--accent);
  }
  .form-group select option { background: var(--surface2); }
  .form-group textarea { resize: vertical; min-height: 100px; }

  /* â”€â”€â”€ BUTTONS â”€â”€â”€ */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 9px 18px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 13px;
    font-family: inherit;
    font-weight: 500;
    transition: all 0.15s;
  }

  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover { background: #3a8fee; }
  .btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
  .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
  .btn-danger { background: rgba(231,76,60,0.2); color: var(--red); border: 1px solid rgba(231,76,60,0.3); }
  .btn-danger:hover { background: rgba(231,76,60,0.35); }
  .btn-sm { padding: 5px 12px; font-size: 12px; }

  /* â”€â”€â”€ MODAL â”€â”€â”€ */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    width: 560px;
    max-width: 95vw;
    max-height: 85vh;
    overflow-y: auto;
    padding: 28px;
  }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }

  .modal-header h2 { font-size: 16px; }
  .modal-close { background: none; border: none; color: var(--text-muted); font-size: 20px; cursor: pointer; }
  .modal-close:hover { color: var(--text); }

  .modal-footer {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
  }

  /* â”€â”€â”€ SEARCH / FILTER BAR â”€â”€â”€ */
  .filter-bar {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .filter-bar input, .filter-bar select {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 14px;
    color: var(--text);
    font-size: 13px;
    font-family: inherit;
    outline: none;
  }

  .filter-bar input { flex: 1; min-width: 200px; }
  .filter-bar input:focus, .filter-bar select:focus { border-color: var(--accent); }
  .filter-bar select option { background: var(--surface2); }

  /* â”€â”€â”€ AI RESULT BOX â”€â”€â”€ */
  .ai-result {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    font-size: 13px;
    line-height: 1.8;
    white-space: pre-wrap;
  }

  .ai-result .ai-label {
    font-size: 11px;
    color: var(--accent);
    font-family: 'Space Mono', monospace;
    margin-bottom: 12px;
    letter-spacing: 1px;
  }

  /* â”€â”€â”€ API SETTINGS â”€â”€â”€ */
  .settings-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    max-width: 600px;
    margin-bottom: 20px;
  }

  .settings-card h3 { font-size: 14px; margin-bottom: 16px; color: var(--text-muted); }

  .toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 20px;
    font-size: 13px;
    z-index: 9999;
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.3s;
  }

  .toast.show { transform: translateY(0); opacity: 1; }
  .toast.success { border-color: var(--green); }
  .toast.error { border-color: var(--red); }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
  }

  .empty-state .icon { font-size: 40px; margin-bottom: 12px; }
  .empty-state p { font-size: 14px; }

  /* â”€â”€â”€ DETAIL VIEW â”€â”€â”€ */
  .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .detail-item .dl { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; }
  .detail-item .dd { font-size: 14px; }

  .history-item {
    display: flex;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
    font-size: 13px;
  }

  .history-item:last-child { border-bottom: none; }
  .history-date { color: var(--text-muted); min-width: 90px; font-family: 'Space Mono', monospace; font-size: 11px; }

  /* â”€â”€â”€ LOADING SPINNER â”€â”€â”€ */
  .spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(79,159,255,0.3);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .flex { display: flex; }
  .gap-2 { gap: 8px; }
  .items-center { align-items: center; }
  .justify-between { justify-content: space-between; }
  .mb-4 { margin-bottom: 16px; }
  .mt-4 { margin-top: 16px; }
</style>
</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <div class="sidebar-logo">
    <h1>RECRUIT AI</h1>
    <p>ì±„ìš© ê´€ë¦¬ ì—ì´ì „íŠ¸</p>
  </div>

  <div class="nav-section">ë©”ë‰´</div>

  <div class="nav-item active" data-page="dashboard">
    <span class="icon">ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
  </div>
  <div class="nav-item" data-page="applicants">
    <span class="icon">ğŸ‘¥</span> ì§€ì›ì ëª©ë¡
    <span class="nav-badge" id="badge-applicants">0</span>
  </div>
  <div class="nav-item" data-page="upload">
    <span class="icon">ğŸ“„</span> ì´ë ¥ì„œ ì—…ë¡œë“œ
  </div>
  <div class="nav-item" data-page="pipeline">
    <span class="icon">ğŸ”„</span> ì±„ìš© íŒŒì´í”„ë¼ì¸
  </div>

  <div class="nav-section">ì„¤ì •</div>
  <div class="nav-item" data-page="settings">
    <span class="icon">âš™ï¸</span> API ì„¤ì •
  </div>
</div>

<!-- MAIN -->
<div id="main">
  <div id="topbar">
    <div id="page-title">ëŒ€ì‹œë³´ë“œ</div>
    <button class="btn btn-primary" id="topbar-action" onclick="openAddModal()">+ ì§€ì›ì ì¶”ê°€</button>
  </div>

  <div id="content">

    <!-- â”€â”€ DASHBOARD â”€â”€ -->
    <div class="page active" id="page-dashboard">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="label">ì „ì²´ ì§€ì›ì</div>
          <div class="value blue" id="stat-total">0</div>
        </div>
        <div class="stat-card">
          <div class="label">ì§„í–‰ì¤‘</div>
          <div class="value yellow" id="stat-active">0</div>
        </div>
        <div class="stat-card">
          <div class="label">ìµœì¢…í•©ê²©</div>
          <div class="value green" id="stat-passed">0</div>
        </div>
        <div class="stat-card">
          <div class="label">ë¶ˆí•©ê²©</div>
          <div class="value red" id="stat-failed">0</div>
        </div>
      </div>

      <div class="pipeline-section">
        <h3>ë‹¨ê³„ë³„ í˜„í™©</h3>
        <div class="pipeline-stages">
          <div class="pipeline-stage">
            <div class="stage-name">ğŸ“‹ ì„œë¥˜ê²€í† </div>
            <div class="stage-count" id="ps-ì„œë¥˜ê²€í† " style="color:var(--accent)">0</div>
          </div>
          <div class="pipeline-stage">
            <div class="stage-name">ğŸ¤ 1ì°¨ë©´ì ‘</div>
            <div class="stage-count" id="ps-1ì°¨ë©´ì ‘" style="color:#9c7fff">0</div>
          </div>
          <div class="pipeline-stage">
            <div class="stage-name">ğŸ¯ 2ì°¨ë©´ì ‘</div>
            <div class="stage-count" id="ps-2ì°¨ë©´ì ‘" style="color:var(--yellow)">0</div>
          </div>
          <div class="pipeline-stage">
            <div class="stage-name">âœ… ìµœì¢…í•©ê²©</div>
            <div class="stage-count" id="ps-ìµœì¢…í•©ê²©" style="color:var(--green)">0</div>
          </div>
          <div class="pipeline-stage">
            <div class="stage-name">âŒ ë¶ˆí•©ê²©</div>
            <div class="stage-count" id="ps-ë¶ˆí•©ê²©" style="color:var(--red)">0</div>
          </div>
        </div>
      </div>

      <div class="table-wrapper">
        <div class="table-header">
          <h3>ìµœê·¼ ì§€ì›ì</h3>
        </div>
        <table>
          <thead>
            <tr>
              <th>ì´ë¦„</th><th>ì§€ì› ì§ë¬´</th><th>ì¶œì²˜</th><th>ë‹¨ê³„</th><th>ë“±ë¡ì¼</th>
            </tr>
          </thead>
          <tbody id="recent-tbody">
            <tr><td colspan="5"><div class="empty-state"><div class="icon">ğŸ“­</div><p>ë“±ë¡ëœ ì§€ì›ìê°€ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- â”€â”€ APPLICANTS â”€â”€ -->
    <div class="page" id="page-applicants">
      <div class="filter-bar">
        <input type="text" id="search-input" placeholder="ğŸ”  ì´ë¦„, ì§ë¬´ ê²€ìƒ‰...">
        <select id="filter-stage">
          <option value="">ì „ì²´ ë‹¨ê³„</option>
          <option>ì„œë¥˜ê²€í† </option>
          <option>1ì°¨ë©´ì ‘</option>
          <option>2ì°¨ë©´ì ‘</option>
          <option>ìµœì¢…í•©ê²©</option>
          <option>ë¶ˆí•©ê²©</option>
          <option>ë³´ë¥˜</option>
        </select>
        <select id="filter-source">
          <option value="">ì „ì²´ ì¶œì²˜</option>
          <option>ì‚¬ëŒì¸</option>
          <option>ì¡ì½”ë¦¬ì•„</option>
          <option>PDFì´ë ¥ì„œ</option>
          <option>ì§ì ‘ì…ë ¥</option>
        </select>
      </div>

      <div class="table-wrapper">
        <div class="table-header">
          <h3>ì§€ì›ì ëª©ë¡</h3>
          <span id="filter-count" style="font-size:12px;color:var(--text-muted)"></span>
        </div>
        <table>
          <thead>
            <tr>
              <th>ì´ë¦„</th><th>ì—°ë½ì²˜</th><th>ì§€ì› ì§ë¬´</th><th>ì¶œì²˜</th><th>ë‹¨ê³„</th><th>ë“±ë¡ì¼</th><th>ì•¡ì…˜</th>
            </tr>
          </thead>
          <tbody id="applicants-tbody">
            <tr><td colspan="7"><div class="empty-state"><div class="icon">ğŸ“­</div><p>ë“±ë¡ëœ ì§€ì›ìê°€ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- â”€â”€ UPLOAD â”€â”€ -->
    <div class="page" id="page-upload">
      <div class="upload-zone" id="upload-zone">
        <div class="upload-icon">ğŸ“„</div>
        <h3>ì´ë ¥ì„œ íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</h3>
        <p>ì‚¬ëŒì¸ / ì¡ì½”ë¦¬ì•„ HTML ë˜ëŠ” PDF íŒŒì¼ ì§€ì› (ìµœëŒ€ 10MB)</p>
        <input type="file" id="file-input" accept=".pdf,.html,.htm,.txt" style="display:none" multiple>
      </div>

      <div id="parsed-result" style="display:none">
        <div class="table-wrapper mb-4">
          <div class="table-header">
            <h3>íŒŒì‹±ëœ ì´ë ¥ì„œ ì •ë³´</h3>
          </div>
          <div style="padding:20px">
            <div class="detail-grid" id="parsed-info"></div>
          </div>
        </div>

        <div id="ai-summary-box" style="display:none">
          <div class="ai-result">
            <div class="ai-label">âœ¦ AI ìš”ì•½ ë¶„ì„</div>
            <div id="ai-summary-text">ë¶„ì„ ì¤‘...</div>
          </div>
        </div>

        <div class="flex gap-2 mt-4">
          <button class="btn btn-primary" onclick="saveFromUpload()">ğŸ’¾ ì§€ì›ìë¡œ ì €ì¥</button>
          <button class="btn btn-secondary" id="ai-analyze-btn" onclick="analyzeWithAI()">ğŸ¤– AI ë¶„ì„ ìš”ì²­</button>
          <button class="btn btn-secondary" onclick="clearUpload()">ğŸ”„ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ PIPELINE â”€â”€ -->
    <div class="page" id="page-pipeline">
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px" id="pipeline-board">
        <!-- JSë¡œ ë Œë”ë§ -->
      </div>
    </div>

    <!-- â”€â”€ SETTINGS â”€â”€ -->
    <div class="page" id="page-settings">
      <div class="settings-card">
        <h3>ğŸ¤– Gemini API ì„¤ì •</h3>
        <div class="form-group">
          <label>Gemini API Key</label>
          <input type="password" id="api-key-input" placeholder="AIza..." value="">
        </div>
        <div class="form-group">
          <label>ëª¨ë¸</label>
          <select id="model-select">
            <option value="gemini-1.5-flash">gemini-1.5-flash (ë¹ ë¦„, ë¬´ë£Œ)</option>
            <option value="gemini-1.5-pro">gemini-1.5-pro (ì •í™•, ìœ ë£Œ)</option>
          </select>
        </div>
        <button class="btn btn-primary" onclick="saveApiKey()">ì €ì¥</button>
      </div>

      <div class="settings-card">
        <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
        <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px">ëª¨ë“  ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì € ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ë©ë‹ˆë‹¤.</p>
        <div class="flex gap-2">
          <button class="btn btn-secondary" onclick="exportData()">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)</button>
          <button class="btn btn-secondary" onclick="importDataClick()">ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
          <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
        <input type="file" id="import-input" accept=".json" style="display:none" onchange="importData(event)">
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->

<!-- â”€â”€ MODAL: ì§€ì›ì ì¶”ê°€/ìˆ˜ì • â”€â”€ -->
<div class="modal-overlay" id="add-modal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modal-title">ì§€ì›ì ì¶”ê°€</h2>
      <button class="modal-close" onclick="closeModal('add-modal')">Ã—</button>
    </div>

    <input type="hidden" id="edit-id">

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
      <div class="form-group">
        <label>ì´ë¦„ *</label>
        <input type="text" id="f-name" placeholder="í™ê¸¸ë™">
      </div>
      <div class="form-group">
        <label>ì—°ë½ì²˜</label>
        <input type="text" id="f-phone" placeholder="010-0000-0000">
      </div>
      <div class="form-group">
        <label>ì´ë©”ì¼</label>
        <input type="email" id="f-email" placeholder="email@example.com">
      </div>
      <div class="form-group">
        <label>ì§€ì› ì§ë¬´ *</label>
        <input type="text" id="f-job" placeholder="í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì">
      </div>
      <div class="form-group">
        <label>ì¶œì²˜</label>
        <select id="f-source">
          <option>ì‚¬ëŒì¸</option>
          <option>ì¡ì½”ë¦¬ì•„</option>
          <option>PDFì´ë ¥ì„œ</option>
          <option>ì§ì ‘ì…ë ¥</option>
        </select>
      </div>
      <div class="form-group">
        <label>ì±„ìš© ë‹¨ê³„</label>
        <select id="f-stage">
          <option>ì„œë¥˜ê²€í† </option>
          <option>1ì°¨ë©´ì ‘</option>
          <option>2ì°¨ë©´ì ‘</option>
          <option>ìµœì¢…í•©ê²©</option>
          <option>ë¶ˆí•©ê²©</option>
          <option>ë³´ë¥˜</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label>ê²½ë ¥ / í•™ë ¥ ìš”ì•½</label>
      <textarea id="f-career" placeholder="ì£¼ìš” ê²½ë ¥, í•™ë ¥ ë“± ì…ë ¥..."></textarea>
    </div>

    <div class="form-group">
      <label>ë©”ëª¨</label>
      <textarea id="f-memo" placeholder="ë©´ì ‘ í”¼ë“œë°±, íŠ¹ì´ì‚¬í•­ ë“±..." style="min-height:70px"></textarea>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('add-modal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="saveApplicant()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- â”€â”€ MODAL: ì§€ì›ì ìƒì„¸ â”€â”€ -->
<div class="modal-overlay" id="detail-modal">
  <div class="modal" style="width:640px">
    <div class="modal-header">
      <h2 id="detail-name">ì§€ì›ì ìƒì„¸</h2>
      <button class="modal-close" onclick="closeModal('detail-modal')">Ã—</button>
    </div>
    <div id="detail-content"></div>
    <div class="modal-footer">
      <button class="btn btn-danger btn-sm" id="detail-delete-btn">ğŸ—‘ï¸ ì‚­ì œ</button>
      <button class="btn btn-secondary" onclick="closeModal('detail-modal')">ë‹«ê¸°</button>
      <button class="btn btn-primary" id="detail-edit-btn">âœï¸ ìˆ˜ì •</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let applicants = JSON.parse(localStorage.getItem('rma_applicants') || '[]');
let apiKey = localStorage.getItem('rma_api_key') || '';
let modelName = localStorage.getItem('rma_model') || 'gemini-1.5-flash';
let currentDetailId = null;
let uploadedParsed = null;

// â”€â”€â”€ NAVIGATION â”€â”€â”€
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', function () {
    const page = this.dataset.page;
    if (!page) return;

    // update active nav
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    this.classList.add('active');

    // show page
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');

    // update title
    const titles = {
      dashboard: 'ëŒ€ì‹œë³´ë“œ',
      applicants: 'ì§€ì›ì ëª©ë¡',
      upload: 'ì´ë ¥ì„œ ì—…ë¡œë“œ',
      pipeline: 'ì±„ìš© íŒŒì´í”„ë¼ì¸',
      settings: 'ì„¤ì •',
    };
    document.getElementById('page-title').textContent = titles[page] || page;

    // page-specific render
    if (page === 'dashboard') renderDashboard();
    if (page === 'applicants') renderApplicants();
    if (page === 'pipeline') renderPipeline();
  });
});

// â”€â”€â”€ INIT â”€â”€â”€
document.getElementById('api-key-input').value = apiKey;
document.getElementById('model-select').value = modelName;
renderDashboard();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   DATA HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function save() {
  localStorage.setItem('rma_applicants', JSON.stringify(applicants));
  updateBadge();
}

function updateBadge() {
  document.getElementById('badge-applicants').textContent = applicants.length;
}

function genId() { return Date.now().toString(36) + Math.random().toString(36).slice(2,5); }

function today() { return new Date().toLocaleDateString('ko-KR'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard() {
  const total = applicants.length;
  const passed = applicants.filter(a => a.stage === 'ìµœì¢…í•©ê²©').length;
  const failed = applicants.filter(a => a.stage === 'ë¶ˆí•©ê²©').length;
  const active = total - passed - failed;

  document.getElementById('stat-total').textContent = total;
  document.getElementById('stat-active').textContent = active;
  document.getElementById('stat-passed').textContent = passed;
  document.getElementById('stat-failed').textContent = failed;

  const stages = ['ì„œë¥˜ê²€í† ','1ì°¨ë©´ì ‘','2ì°¨ë©´ì ‘','ìµœì¢…í•©ê²©','ë¶ˆí•©ê²©'];
  stages.forEach(s => {
    const el = document.getElementById('ps-'+s);
    if (el) el.textContent = applicants.filter(a => a.stage === s).length;
  });

  // recent 5
  const recent = [...applicants].sort((a,b) => b.createdAt - a.createdAt).slice(0,5);
  const tbody = document.getElementById('recent-tbody');
  if (!recent.length) {
    tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="icon">ğŸ“­</div><p>ë“±ë¡ëœ ì§€ì›ìê°€ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>';
    return;
  }
  tbody.innerHTML = recent.map(a => `
    <tr style="cursor:pointer" onclick="openDetail('${a.id}')">
      <td>${a.name}</td>
      <td>${a.job || '-'}</td>
      <td>${a.source || '-'}</td>
      <td><span class="badge ${a.stage}">${a.stage}</span></td>
      <td>${new Date(a.createdAt).toLocaleDateString('ko-KR')}</td>
    </tr>
  `).join('');

  updateBadge();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   APPLICANTS LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderApplicants(filter = {}) {
  let list = [...applicants];

  const q = document.getElementById('search-input')?.value.toLowerCase() || '';
  const stage = document.getElementById('filter-stage')?.value || '';
  const source = document.getElementById('filter-source')?.value || '';

  if (q) list = list.filter(a => a.name.toLowerCase().includes(q) || (a.job||'').toLowerCase().includes(q));
  if (stage) list = list.filter(a => a.stage === stage);
  if (source) list = list.filter(a => a.source === source);

  list.sort((a,b) => b.createdAt - a.createdAt);

  document.getElementById('filter-count').textContent = `${list.length}ëª…`;

  const tbody = document.getElementById('applicants-tbody');
  if (!list.length) {
    tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="icon">ğŸ”</div><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p></div></td></tr>';
    return;
  }

  tbody.innerHTML = list.map(a => `
    <tr>
      <td><strong style="cursor:pointer;color:var(--accent)" onclick="openDetail('${a.id}')">${a.name}</strong></td>
      <td>${a.phone || '-'}</td>
      <td>${a.job || '-'}</td>
      <td>${a.source || '-'}</td>
      <td><span class="badge ${a.stage}">${a.stage}</span></td>
      <td>${new Date(a.createdAt).toLocaleDateString('ko-KR')}</td>
      <td>
        <div class="flex gap-2">
          <button class="btn btn-secondary btn-sm" onclick="openEdit('${a.id}')">ìˆ˜ì •</button>
          <button class="btn btn-danger btn-sm" onclick="deleteApplicant('${a.id}')">ì‚­ì œ</button>
        </div>
      </td>
    </tr>
  `).join('');
}

// ì‹¤ì‹œê°„ í•„í„°
['search-input','filter-stage','filter-source'].forEach(id => {
  document.getElementById(id)?.addEventListener('input', () => renderApplicants());
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   PIPELINE BOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPipeline() {
  const stages = [
    { key:'ì„œë¥˜ê²€í† ', color:'var(--accent)', emoji:'ğŸ“‹' },
    { key:'1ì°¨ë©´ì ‘', color:'#9c7fff', emoji:'ğŸ¤' },
    { key:'2ì°¨ë©´ì ‘', color:'var(--yellow)', emoji:'ğŸ¯' },
    { key:'ìµœì¢…í•©ê²©', color:'var(--green)', emoji:'âœ…' },
    { key:'ë¶ˆí•©ê²©',  color:'var(--red)',   emoji:'âŒ' },
    { key:'ë³´ë¥˜',    color:'var(--text-muted)', emoji:'â¸ï¸' },
  ];

  document.getElementById('pipeline-board').innerHTML = stages.map(st => {
    const items = applicants.filter(a => a.stage === st.key);
    return `
      <div style="background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden">
        <div style="padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px">
          <span>${st.emoji}</span>
          <span style="font-size:13px;font-weight:600;color:${st.color}">${st.key}</span>
          <span style="margin-left:auto;background:var(--surface2);font-size:11px;padding:2px 8px;border-radius:20px;font-family:'Space Mono',monospace">${items.length}</span>
        </div>
        <div style="padding:12px;display:flex;flex-direction:column;gap:8px;min-height:80px">
          ${items.length ? items.map(a => `
            <div onclick="openDetail('${a.id}')" style="background:var(--surface2);border-radius:8px;padding:12px;cursor:pointer;transition:opacity 0.15s" onmouseover="this.style.opacity=0.8" onmouseout="this.style.opacity=1">
              <div style="font-size:13px;font-weight:600;margin-bottom:4px">${a.name}</div>
              <div style="font-size:11px;color:var(--text-muted)">${a.job || '-'}</div>
              <div style="font-size:10px;color:var(--text-muted);margin-top:4px">${a.source || ''}</div>
            </div>
          `).join('') : '<div style="font-size:12px;color:var(--text-muted);text-align:center;padding:20px">ì—†ìŒ</div>'}
        </div>
      </div>
    `;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   MODAL: ADD / EDIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAddModal() {
  document.getElementById('modal-title').textContent = 'ì§€ì›ì ì¶”ê°€';
  document.getElementById('edit-id').value = '';
  ['name','phone','email','job','career','memo'].forEach(f => document.getElementById('f-'+f).value = '');
  document.getElementById('f-source').value = 'ì§ì ‘ì…ë ¥';
  document.getElementById('f-stage').value = 'ì„œë¥˜ê²€í† ';
  openModal('add-modal');
}

function openEdit(id) {
  const a = applicants.find(x => x.id === id);
  if (!a) return;
  closeModal('detail-modal');
  document.getElementById('modal-title').textContent = 'ì§€ì›ì ìˆ˜ì •';
  document.getElementById('edit-id').value = id;
  document.getElementById('f-name').value = a.name || '';
  document.getElementById('f-phone').value = a.phone || '';
  document.getElementById('f-email').value = a.email || '';
  document.getElementById('f-job').value = a.job || '';
  document.getElementById('f-source').value = a.source || 'ì§ì ‘ì…ë ¥';
  document.getElementById('f-stage').value = a.stage || 'ì„œë¥˜ê²€í† ';
  document.getElementById('f-career').value = a.career || '';
  document.getElementById('f-memo').value = a.memo || '';
  openModal('add-modal');
}

function saveApplicant() {
  const name = document.getElementById('f-name').value.trim();
  const job  = document.getElementById('f-job').value.trim();
  if (!name) { showToast('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error'); return; }

  const id = document.getElementById('edit-id').value;
  const data = {
    name, job,
    phone: document.getElementById('f-phone').value.trim(),
    email: document.getElementById('f-email').value.trim(),
    source: document.getElementById('f-source').value,
    stage: document.getElementById('f-stage').value,
    career: document.getElementById('f-career').value.trim(),
    memo: document.getElementById('f-memo').value.trim(),
  };

  if (id) {
    const idx = applicants.findIndex(a => a.id === id);
    const old = applicants[idx];
    // ë‹¨ê³„ ë³€ê²½ ê¸°ë¡
    if (old.stage !== data.stage) {
      if (!old.history) old.history = [];
      old.history.push({ date: today(), action: `ë‹¨ê³„ ë³€ê²½: ${old.stage} â†’ ${data.stage}` });
      data.history = old.history;
    } else {
      data.history = old.history || [];
    }
    data.id = id;
    data.createdAt = old.createdAt;
    applicants[idx] = data;
    showToast('ìˆ˜ì • ì™„ë£Œ!', 'success');
  } else {
    data.id = genId();
    data.createdAt = Date.now();
    data.history = [{ date: today(), action: 'ì§€ì›ì ë“±ë¡' }];
    applicants.push(data);
    showToast('ì €ì¥ ì™„ë£Œ!', 'success');
  }

  save();
  closeModal('add-modal');
  renderDashboard();
  renderApplicants();
}

function deleteApplicant(id) {
  if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  applicants = applicants.filter(a => a.id !== id);
  save();
  closeModal('detail-modal');
  renderDashboard();
  renderApplicants();
  showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   DETAIL MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openDetail(id) {
  const a = applicants.find(x => x.id === id);
  if (!a) return;
  currentDetailId = id;

  document.getElementById('detail-name').textContent = a.name;
  document.getElementById('detail-content').innerHTML = `
    <div class="detail-grid mb-4">
      <div class="detail-item"><div class="dl">ì§€ì› ì§ë¬´</div><div class="dd">${a.job||'-'}</div></div>
      <div class="detail-item"><div class="dl">ì±„ìš© ë‹¨ê³„</div><div class="dd"><span class="badge ${a.stage}">${a.stage}</span></div></div>
      <div class="detail-item"><div class="dl">ì—°ë½ì²˜</div><div class="dd">${a.phone||'-'}</div></div>
      <div class="detail-item"><div class="dl">ì´ë©”ì¼</div><div class="dd">${a.email||'-'}</div></div>
      <div class="detail-item"><div class="dl">ì¶œì²˜</div><div class="dd">${a.source||'-'}</div></div>
      <div class="detail-item"><div class="dl">ë“±ë¡ì¼</div><div class="dd">${new Date(a.createdAt).toLocaleDateString('ko-KR')}</div></div>
    </div>
    ${a.career ? `<div class="form-group"><div class="dl" style="font-size:12px;color:var(--text-muted);margin-bottom:8px">ê²½ë ¥/í•™ë ¥</div><div style="font-size:13px;line-height:1.7;white-space:pre-wrap;background:var(--surface2);padding:14px;border-radius:8px">${a.career}</div></div>` : ''}
    ${a.memo ? `<div class="form-group"><div class="dl" style="font-size:12px;color:var(--text-muted);margin-bottom:8px">ë©”ëª¨</div><div style="font-size:13px;line-height:1.7;white-space:pre-wrap;background:var(--surface2);padding:14px;border-radius:8px">${a.memo}</div></div>` : ''}
    <div style="margin-top:16px">
      <div style="font-size:12px;color:var(--text-muted);margin-bottom:10px">ì§„í–‰ íˆìŠ¤í† ë¦¬</div>
      ${(a.history||[]).map(h => `
        <div class="history-item">
          <span class="history-date">${h.date}</span>
          <span>${h.action}</span>
        </div>
      `).join('') || '<div style="font-size:13px;color:var(--text-muted)">ê¸°ë¡ ì—†ìŒ</div>'}
    </div>
  `;

  document.getElementById('detail-edit-btn').onclick = () => openEdit(id);
  document.getElementById('detail-delete-btn').onclick = () => deleteApplicant(id);

  openModal('detail-modal');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   UPLOAD & PARSE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const uploadZone = document.getElementById('upload-zone');
const fileInput = document.getElementById('file-input');

uploadZone.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', e => {
  if (e.target.files[0]) handleFile(e.target.files[0]);
});

uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragover'); });
uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
uploadZone.addEventListener('drop', e => {
  e.preventDefault();
  uploadZone.classList.remove('dragover');
  if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
});

async function handleFile(file) {
  showToast('íŒŒì¼ ì½ëŠ” ì¤‘...', '');

  let text = '';

  if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
    // PDF â†’ pdf.js ì—†ì´ ê¸°ë³¸ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹œë„ (ì œí•œì )
    text = await readPDF(file);
  } else {
    text = await file.text();
  }

  const parsed = parseResume(text, file.name);
  uploadedParsed = parsed;

  document.getElementById('parsed-info').innerHTML = `
    <div class="detail-item"><div class="dl">ì´ë¦„</div><div class="dd">${parsed.name||'?'}</div></div>
    <div class="detail-item"><div class="dl">ì—°ë½ì²˜</div><div class="dd">${parsed.phone||'?'}</div></div>
    <div class="detail-item"><div class="dl">ì´ë©”ì¼</div><div class="dd">${parsed.email||'?'}</div></div>
    <div class="detail-item"><div class="dl">ì¶œì²˜</div><div class="dd">${parsed.source}</div></div>
    <div class="detail-item" style="grid-column:1/-1"><div class="dl">ì¶”ì¶œ í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°</div><div class="dd" style="font-size:11px;color:var(--text-muted);max-height:120px;overflow:auto;white-space:pre-wrap;background:var(--surface2);padding:10px;border-radius:6px;margin-top:4px">${text.slice(0,600)}...</div></div>
  `;

  document.getElementById('parsed-result').style.display = 'block';
  document.getElementById('ai-summary-box').style.display = 'none';
  showToast('íŒŒì¼ íŒŒì‹± ì™„ë£Œ!', 'success');
}

async function readPDF(file) {
  return new Promise(resolve => {
    const reader = new FileReader();
    reader.onload = e => {
      // ArrayBufferë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (ë‹¨ìˆœ ì¶”ì¶œ)
      const bytes = new Uint8Array(e.target.result);
      let str = '';
      for (let i = 0; i < bytes.length; i++) {
        const c = bytes[i];
        if (c >= 32 && c < 127) str += String.fromCharCode(c);
        else if (c === 10 || c === 13) str += '\n';
      }
      // ì˜ë¯¸ ìˆëŠ” ë‹¨ì–´ë§Œ ì¶”ì¶œ
      const lines = str.split('\n').map(l => l.trim()).filter(l => l.length > 2);
      resolve(lines.join('\n'));
    };
    reader.readAsArrayBuffer(file);
  });
}

function parseResume(text, filename) {
  const lower = text.toLowerCase();
  const isSaramin = lower.includes('saramin') || lower.includes('ì‚¬ëŒì¸') || filename.includes('saramin');
  const isJobkorea = lower.includes('jobkorea') || lower.includes('ì¡ì½”ë¦¬ì•„') || filename.includes('jobkorea');

  const phoneMatch = text.match(/0\d{1,2}[-.\s]?\d{3,4}[-.\s]?\d{4}/);
  const emailMatch = text.match(/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}/);
  const nameMatch  = text.match(/(?:ì´ë¦„|ì„±ëª…)\s*[:ï¼š]?\s*([ê°€-í£]{2,4})/);

  return {
    name: nameMatch?.[1] || '',
    phone: phoneMatch?.[0] || '',
    email: emailMatch?.[0] || '',
    source: isSaramin ? 'ì‚¬ëŒì¸' : isJobkorea ? 'ì¡ì½”ë¦¬ì•„' : 'PDFì´ë ¥ì„œ',
    rawText: text.slice(0, 3000),
  };
}

async function analyzeWithAI() {
  if (!apiKey) {
    showToast('API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤. ì„¤ì •ì—ì„œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
    return;
  }
  if (!uploadedParsed) return;

  const btn = document.getElementById('ai-analyze-btn');
  btn.innerHTML = '<span class="spinner"></span> ë¶„ì„ ì¤‘...';
  btn.disabled = true;

  document.getElementById('ai-summary-box').style.display = 'block';
  document.getElementById('ai-summary-text').textContent = 'ë¶„ì„ ì¤‘...';

  const prompt = `ë‹¤ìŒì€ ì§€ì›ìì˜ ì´ë ¥ì„œ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì•„ë˜ í•­ëª©ì„ í•œêµ­ì–´ë¡œ êµ¬ì¡°í™”í•´ì„œ ìš”ì•½í•´ì£¼ì„¸ìš”:

1. ì´ë¦„ (ì¶”ì •)
2. ì£¼ìš” ê²½ë ¥ ìš”ì•½
3. í•µì‹¬ ê¸°ìˆ /ìŠ¤í‚¬
4. í•™ë ¥
5. ì´ ì§€ì›ìì˜ ê°•ì 
6. ì±„ìš© ì í•©ì„± ì½”ë©˜íŠ¸ (ì„œë¥˜ í†µê³¼ ì—¬ë¶€ ì¶”ì²œ)

ì´ë ¥ì„œ í…ìŠ¤íŠ¸:
${uploadedParsed.rawText}`;

  try {
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }),
    });
    const data = await res.json();
    const result = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'AI ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
    document.getElementById('ai-summary-text').textContent = result;
    uploadedParsed.career = result;
  } catch (e) {
    document.getElementById('ai-summary-text').textContent = 'ì˜¤ë¥˜: ' + e.message;
  }

  btn.innerHTML = 'ğŸ¤– AI ë¶„ì„ ìš”ì²­';
  btn.disabled = false;
}

function saveFromUpload() {
  if (!uploadedParsed) return;

  const a = {
    id: genId(),
    name: uploadedParsed.name || 'ì´ë¦„ ë¯¸ìƒ',
    phone: uploadedParsed.phone || '',
    email: uploadedParsed.email || '',
    source: uploadedParsed.source,
    stage: 'ì„œë¥˜ê²€í† ',
    career: uploadedParsed.career || uploadedParsed.rawText?.slice(0, 500) || '',
    memo: '',
    createdAt: Date.now(),
    history: [{ date: today(), action: 'ì´ë ¥ì„œ ì—…ë¡œë“œë¡œ ë“±ë¡ (' + uploadedParsed.source + ')' }],
  };

  applicants.push(a);
  save();
  clearUpload();
  renderDashboard();
  showToast('ì§€ì›ìë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');

  // navigate to applicants
  document.querySelector('.nav-item[data-page="applicants"]').click();
}

function clearUpload() {
  uploadedParsed = null;
  document.getElementById('parsed-result').style.display = 'none';
  document.getElementById('file-input').value = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveApiKey() {
  apiKey = document.getElementById('api-key-input').value.trim();
  modelName = document.getElementById('model-select').value;
  localStorage.setItem('rma_api_key', apiKey);
  localStorage.setItem('rma_model', modelName);
  showToast('API í‚¤ ì €ì¥ ì™„ë£Œ!', 'success');
}

function exportData() {
  const blob = new Blob([JSON.stringify({ applicants }, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'recruitment_data_' + new Date().toISOString().slice(0,10) + '.json';
  a.click();
}

function importDataClick() { document.getElementById('import-input').click(); }

function importData(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    try {
      const data = JSON.parse(ev.target.result);
      if (data.applicants) {
        applicants = data.applicants;
        save();
        renderDashboard();
        showToast('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!', 'success');
      }
    } catch { showToast('íŒŒì¼ í˜•ì‹ ì˜¤ë¥˜', 'error'); }
  };
  reader.readAsText(file);
}

function clearAllData() {
  if (!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
  applicants = [];
  save();
  renderDashboard();
  renderApplicants();
  showToast('ì´ˆê¸°í™” ì™„ë£Œ', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//   MODAL HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id) {
  document.getElementById(id).classList.add('open');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// click outside to close
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) overlay.classList.remove('open');
  });
});

// â”€â”€â”€ TOAST â”€â”€â”€
function showToast(msg, type = '') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast show ' + type;
  setTimeout(() => { t.className = 'toast'; }, 2500);
}

// â”€â”€â”€ INIT â”€â”€â”€
updateBadge();
</script>
</body>
</html>
